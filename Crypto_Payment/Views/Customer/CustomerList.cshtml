@{
    ViewBag.Title = "Müşteri Listesi";
    Layout = "_Layout";
}

 <div class="container-fluid">
                    <!-- start page title -->
                    <div class="row">
                        <div class="col-12">
                            <div class="page-title-box d-sm-flex align-items-center justify-content-between bg-galaxy-transparent">
                                <h4 class="mb-sm-0">Müşteriler</h4>
                            </div>
                        </div>
                    </div>
                    <!-- end page title -->

                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card">
                                <div class="card-header">
                                    <div class="d-flex align-items-center flex-wrap gap-2">
                                        <div class="flex-grow-1">
                                            <button class="btn btn-info add-btn" data-bs-toggle="modal" data-bs-target="#showModal"><i class="ri-add-fill me-1 align-bottom"></i> Müşteri Ekle</button>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <div class="hstack text-nowrap gap-2">
                                                <button class="btn btn-soft-danger material-shadow-none" id="remove-actions" onClick="deleteMultiple()"><i class="ri-delete-bin-2-line"></i></button>
                                                <button class="btn btn-danger material-shadow-none"><i class="ri-filter-2-line me-1 align-bottom"></i> Filtrele</button>
                                                @* <button class="btn btn-soft-success material-shadow-none">Import</button> *@
                                                @* <button type="button" id="dropdownMenuLink1" data-bs-toggle="dropdown" aria-expanded="false" class="btn btn-soft-info material-shadow-none"><i class="ri-more-2-fill"></i></button> *@
                                                @* <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink1"> *@
                                                @*     <li><a class="dropdown-item" href="#">All</a></li> *@
                                                @*     <li><a class="dropdown-item" href="#">Last Week</a></li> *@
                                                @*     <li><a class="dropdown-item" href="#">Last Month</a></li> *@
                                                @*     <li><a class="dropdown-item" href="#">Last Year</a></li> *@
                                                @* </ul> *@
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--end col-->
                        <div class="col-xxl-9">
                            <div class="card" id="contactList">
                                <div class="card-header">
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <div class="search-box">
                                                <input type="text" class="form-control search" placeholder="Müşteri ara...">
                                                <i class="ri-search-line search-icon"></i>
                                            </div>
                                        </div>
                                        <div class="col-md-auto ms-auto">
                                            <div class="d-flex align-items-center gap-2">
                                                <span class="text-muted">Sırala: </span>
                                                <select class="form-control mb-0" data-choices data-choices-search-false id="choices-single-default">
                                                    <option value="Name">Name</option>
                                                    <option value="Company">Company</option>
                                                    <option value="Lead">Lead</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div>
                                        <div class="table-responsive table-card mb-3">
                                            <table class="table align-middle table-nowrap mb-0" id="customerTable">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th scope="col" style="width: 50px;">
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="checkbox" id="checkAll" value="option">
                                                            </div>
                                                        </th>
                                                        <th class="sort" data-sort="name" scope="col">Ad Soyad</th>
                                                        <th class="sort" data-sort="phone" scope="col">Telefon No</th>
                                                        <th class="sort" data-sort="lead_score" scope="col">Şirket Adı</th>
                                                        <th class="sort" data-sort="tags" scope="col">Telegram</th>
                                                        <th class="sort" data-sort="date" scope="col">Skype</th>
                                                        <th scope="col">Eylemler</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="customerList" class="list form-check-all">

                                                </tbody>
                                            </table>
                                            <div class="noresult" style="display: none">
                                                <div class="text-center">
                                                    <lord-icon src="https://cdn.lordicon.com/msoeawqm.json" trigger="loop" colors="primary:#121331,secondary:#08a88a" style="width:75px;height:75px"></lord-icon>
                                                    <h5 class="mt-2">Sorry! No Result Found</h5>
                                                    <p class="text-muted mb-0">We've searched more than 150+ contacts We did not find any contacts for you search.</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-end mt-3">
                                            <div class="pagination-wrap hstack gap-2">
                                                <a class="page-item pagination-prev disabled" href="#">
                                                    Previous
                                                </a>
                                                <ul class="pagination listjs-pagination mb-0"></ul>
                                                <a class="page-item pagination-next" href="#">
                                                    Next
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal fade" id="showModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered">
                                            <div class="modal-content border-0">
                                                <div class="modal-header bg-info-subtle p-3">
                                                    <h5 class="modal-title" id="exampleModalLabel">Müşteri Ekle</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="close-modal"></button>
                                                </div>
                                                <form id="customerAddForm" class="tablelist-form" autocomplete="off">
                                                    <div class="modal-body">
                                                        <input type="hidden" id="id-field" />
                                                        <div class="row g-3">
                                                            <div class="col-lg-12">
                                                                <div class="text-center">
                                                                    <div class="position-relative d-inline-block">
                                                                        <div class="position-absolute  bottom-0 end-0">
                                                                            <label for="customer-image-input" class="mb-0" data-bs-toggle="tooltip" data-bs-placement="right" title="Select Image">
                                                                                <div class="avatar-xs cursor-pointer">
                                                                                    <div class="avatar-title bg-light border rounded-circle text-muted">
                                                                                        <i class="ri-image-fill"></i>
                                                                                    </div>
                                                                                </div>
                                                                            </label>
                                                                            <input class="form-control d-none" value="" id="customer-image-input" type="file" accept="image/png, image/gif, image/jpeg">
                                                                        </div>
                                                                        <div class="avatar-lg p-1">
                                                                            <div class="avatar-title bg-light rounded-circle">
                                                                                <img src="assets/images/users/user-dummy-img.jpg" id="customer-img" class="avatar-md rounded-circle object-fit-cover" />
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-6">
                                                                <div>
                                                                    <label for="firstName" class="form-label">Ad</label>
                                                                    <input type="text" id="firstName" class="form-control" placeholder="Adı Girin" required />
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-6">
                                                                <div>
                                                                    <label for="lastName" class="form-label">Soyad</label>
                                                                    <input type="text" id="lastName" class="form-control" placeholder="Soyadı Girin" required />
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-12">
                                                                <div>
                                                                    <label for="companyName" class="form-label">Şirket Adı</label>
                                                                    <input type="text" id="companyName" class="form-control" placeholder="Şirket Adını Girin" required />
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-6">
                                                                <div>
                                                                    <label for="email" class="form-label">E-Posta</label>
                                                                    <input type="text" id="email" class="form-control" placeholder="E-Posta Girin" required />
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-6">
                                                                <div>
                                                                    <label for="phone" class="form-label">Telefon</label>
                                                                    <input type="text" id="phone" class="form-control" placeholder="Tel No Girin" required />
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-6">
                                                                <div>
                                                                    <label for="telegram" class="form-label">Telegram</label>
                                                                    <input type="text" id="telegram" class="form-control" placeholder="Telegram Adresi Girin" required />
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-6">
                                                                <div>
                                                                    <label for="skype" class="form-label">Skype</label>
                                                                    <input type="text" id="skype" class="form-control" placeholder="Skype Adresi Girin" required />
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-12">
                                                                <div id="apiError" class="alert alert-danger d-none"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <div class="hstack gap-2 justify-content-end">
                                                            <button type="button" class="btn btn-light" data-bs-dismiss="modal">Kapat</button>
                                                            <button type="submit" class="btn btn-success" id="add-btn">Müşteri Ekle</button>
                                                            <!-- <button type="button" class="btn btn-success" id="edit-btn">Update</button> -->
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <!--end add modal-->

                                    <div class="modal fade zoomIn" id="deleteRecordModal" tabindex="-1" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <button type="button" class="btn-close" id="deleteRecord-close"  data-bs-dismiss="modal" aria-label="Close" id="btn-close"></button>
                                                </div>
                                                <div class="modal-body p-5 text-center">
                                                    <lord-icon src="https://cdn.lordicon.com/gsqxdxog.json" trigger="loop" colors="primary:#405189,secondary:#f06548" style="width:90px;height:90px"></lord-icon>
                                                    <div class="mt-4 text-center">
                                                        <h4 class="fs-semibold">You are about to delete a contact ?</h4>
                                                        <p class="text-muted fs-14 mb-4 pt-1">Deleting your contact will remove all of your information from our database.</p>
                                                        <div class="hstack gap-2 justify-content-center remove">
                                                            <button class="btn btn-link link-success fw-medium text-decoration-none material-shadow-none" id="deleteRecord-close" data-bs-dismiss="modal"><i class="ri-close-line me-1 align-middle"></i> Close</button>
                                                            <button class="btn btn-danger" id="delete-record">Yes, Delete It!!</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--end delete modal -->

                                </div>
                            </div>
                            <!--end card-->
                        </div>
                        <!--end col-->
                        <div class="col-xxl-3">
                            <div class="card" id="contact-view-detail">
                                <div class="card-body text-center">
                                    <div class="position-relative d-inline-block">
                                        <img src="assets/images/users/avatar-10.jpg" alt="" class="avatar-lg rounded-circle img-thumbnail material-shadow">
                                        <span class="contact-active position-absolute rounded-circle bg-success"><span class="visually-hidden"></span>
                                    </div>
                                    <h5 class="mt-4 mb-1">Tonya Noble</h5>
                                    <p class="text-muted">Nesta Technologies</p>

                                    <ul class="list-inline mb-0">
                                        <li class="list-inline-item avatar-xs">
                                            <a href="javascript:void(0);" class="avatar-title bg-success-subtle text-success fs-15 rounded">
                                                <i class="ri-phone-line"></i>
                                            </a>
                                        </li>
                                        <li class="list-inline-item avatar-xs">
                                            <a href="javascript:void(0);" class="avatar-title bg-danger-subtle text-danger fs-15 rounded">
                                                <i class="ri-mail-line"></i>
                                            </a>
                                        </li>
                                        <li class="list-inline-item avatar-xs">
                                            <a href="javascript:void(0);" class="avatar-title bg-warning-subtle text-warning fs-15 rounded">
                                                <i class="ri-question-answer-line"></i>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="card-body">
                                    <h6 class="text-muted text-uppercase fw-semibold mb-3">Personal Information</h6>
                                    <p class="text-muted mb-4">Hello, I'm Tonya Noble, The most effective objective is one that is tailored to the job you are applying for. It states what kind of career you are seeking, and what skills and experiences.</p>
                                    <div class="table-responsive table-card">
                                        <table class="table table-borderless mb-0">
                                            <tbody>
                                                <tr>
                                                    <td class="fw-medium" scope="row">Designation</td>
                                                    <td>Lead Designer / Developer</td>
                                                </tr>
                                                <tr>
                                                    <td class="fw-medium" scope="row">Email ID</td>
                                                    <td>tonyanoble@velzon.com</td>
                                                </tr>
                                                <tr>
                                                    <td class="fw-medium" scope="row">Phone No</td>
                                                    <td>414-453-5725</td>
                                                </tr>
                                                <tr>
                                                    <td class="fw-medium" scope="row">Lead Score</td>
                                                    <td>154</td>
                                                </tr>
                                                <tr>
                                                    <td class="fw-medium" scope="row">Tags</td>
                                                    <td>
                                                        <span class="badge bg-primary-subtle text-primary">Lead</span>
                                                        <span class="badge bg-primary-subtle text-primary">Partner</span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="fw-medium" scope="row">Last Contacted</td>
                                                    <td>15 Dec, 2021 <small class="text-muted">08:58AM</small></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!--end card-->
                        </div>
                        <!--end col-->
                    </div>
                    <!--end row-->

                </div>
<!-- container-fluid -->

@section Scripts {
<script>
document.addEventListener('DOMContentLoaded', async () => {
    const tbody = document.getElementById('customerList');
    if (!tbody) return;

    const res = await fetch('/api/customers/GetAll');
    const list = await res.json();

    tbody.innerHTML = '';

    list.forEach(c => {
        tbody.innerHTML += `
        <tr data-id="${c.id}">
            <th scope="row">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox">
                </div>
            </th>

            <td class="name">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <img src="assets/images/users/avatar-10.jpg" class="avatar-xs rounded-circle">
                    </div>
                    <div class="flex-grow-1 ms-2 name">
                        ${c.firstName} ${c.lastName}
                    </div>
                </div>
            </td>

            <td class="phone">${c.phone}</td>
            <td class="company_name">${c.companyName}</td>
            <td class="lead_score">
                 <a href="${c.telegram}" class="text-muted">
                    <i class="ri-telegram-line fs-22"></i>
                </a>
            </td>
            <td class="tags">
                <a href="${c.skype}" class="text-muted">
                    <i class="ri-skype-line fs-22"></i>
                </a>
            </td>

            <td>
                <ul class="list-inline hstack gap-2 mb-0">
                    <li class="list-inline-item">
                        <a href="javascript:void(0);" class="text-muted">
                            <i class="ri-delete-bin-2-line"></i>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a href="javascript:void(0);" class="text-muted">
                            <i class="ri-restart-line"></i>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <button class="btn btn-soft-secondary btn-sm">
                            <i class="ri-more-fill"></i>
                        </button>
                    </li>
                </ul>
            </td>
        </tr>
        `;
    });
});


document.getElementById('customerAddForm')
    .addEventListener('submit', async function (e) {
        e.preventDefault();

        const apiError = document.getElementById('apiError');
        apiError.classList.add('d-none');
        apiError.innerText = '';

        const payload = {
            firstName: document.getElementById('firstName').value,
            lastName: document.getElementById('lastName').value,
            email: document.getElementById('email').value,
            phone: document.getElementById('phone').value,
            companyName: document.getElementById('companyName').value,
            telegram: document.getElementById('telegram').value,
            skype: document.getElementById('skype').value
        };

        try {
            const res = await fetch('/api/customers/create', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!res.ok) {
                const data = await res.json().catch(() => ({}));
                apiError.innerText = data.title || 'Kayıt başarısız.';
                apiError.classList.remove('d-none');
                return;
            }

            // başarılı → listeye dön
            window.location.href = '/customers';

        } catch {
            apiError.innerText = 'Sunucuya ulaşılamadı.';
            apiError.classList.remove('d-none');
        }
});

tbody.addEventListener('click', async (e) => {
    const tr = e.target.closest('tr');
    if (!tr) return;

    const id = tr.dataset.id;
    if (!id) return;

    // Detay
    if (e.target.closest('.btn-detail')) {
        const res = await fetch(`/api/customers/${id}`);
        const customer = await res.json();

        document.getElementById('customerDetailName').innerText =
            customer.firstName + ' ' + customer.lastName;
    }

    // Sil
    if (e.target.closest('.btn-delete')) {
        if (!confirm('Silmek istediğinize emin misiniz?')) return;

        await fetch(`/api/customers/${id}`, { method: 'DELETE' });
        tr.remove(); // UI'dan kaldır
    }
});

</script>
}
