@model Crypto_Payment.DTOS.PaymentViewModel

@{
    ViewBag.Title = "Fatura Sonucu";
    Layout = null;
}


<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="~/admin/my-css/done.css" rel="stylesheet" type="text/css" />
</head>

<body>

    <div class="wrapper">

        <div class="header">
            <div class="brand">portal.wandaplay.com</div>
            <br/>
            <div class="order-info">Sipariş Numrası: @Model.OrderNumber</div>
        </div>
        
        <div id="amountSection" class="amount-section">
            <div class="fiat-amount">@Model.SourceAmount.ToString("N2") @Model.SourceCurrency</div>
            <div class="crypto-amount">≈ @Model.CryptoAmount @Model.CryptoCurrency.Replace("_", " ")</div>
            <div class="network-badge">@Model.Network</div>
        </div>

        <div class="content">
            <div class="check @GetStatusClass()">
                @Html.Raw(GetStatusIcon())
            </div>
            
            <h1>@GetStatusText()</h1>

            <a class="btn btn-primary" href="/invoices">Siteye Dön</a>
        </div>

        <div class="confetti">
            
        </div>

    </div>

</body>

<script>

    let confettiTriggered = false;

    const status = String('@Model.Status');

    if (["completed", "mismatch", "pending"].includes(status)) {
        triggerConfetti();
    }
    
    // başarılı ise confetti patlatıyor
    function triggerConfetti() {
        if (confettiTriggered) return;
        confettiTriggered = true;
        const duration = 3000;
        const end = Date.now() + duration;
        (function frame() {
            confetti({ particleCount: 3, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#667eea', '#764ba2', '#2e7d32', '#ffd700'] });
            confetti({ particleCount: 3, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#667eea', '#764ba2', '#2e7d32', '#ffd700'] });
            if (Date.now() < end) { requestAnimationFrame(frame); }
        }());
        
        for (let i = 0; i < 30; i++) {
            const s = document.createElement('span');
            s.style.top = -50+'px';
            s.style.left = Math.random() * 100 + '%';
            s.style.animationDelay = Math.random() * 4 + 's';
            document.querySelector('.confetti').appendChild(s);
        }
    }

    @functions {
        string GetStatusClass() { return Model.Status?.ToLower() switch { "completed" or "mismatch" or "pending" => "status-completed", "expired" or "cancelled" or "error" => "status-expired", _ => "status-new" }; }
        string GetStatusText() { return Model.Status?.ToLower() switch { "completed" or "mismatch" or "pending" => "Payment Confirmed!", "expired" => "Payment Expired", "cancelled" => "Payment Cancelled", _ => "Waiting for payment..." }; }
        string GetStatusIcon() { return Model.Status?.ToLower() switch { "completed" or "mismatch" or "pending" => "<svg viewBox=\"0 0 24 24\">\n <polyline points=\"4 12 10 18 20 6\" />\n</svg>", "expired" or "cancelled" => "<svg class=\"status-icon\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\"/></svg>", _ => "<span class=\"spinner\"></span>" }; }
    }
</script>

</html>